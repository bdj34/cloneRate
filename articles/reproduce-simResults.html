<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cloneRate">
<title>Reproduce simulation results • cloneRate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reproduce simulation results">
<meta property="og:description" content="cloneRate">
<meta property="og:image" content="https://bdj34.github.io/cloneRate/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cloneRate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/reproduce-simResults.html">Reproduce simulation results</a>
    <a class="dropdown-item" href="../articles/cloneRate-dataAnalysis.html">Analysis of human blood data</a>
    <a class="dropdown-item" href="../articles/cloneRate-simulate.html">Validating growth rate estimates via simulation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bdj34/cloneRate/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reproduce simulation results</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bdj34/cloneRate/blob/HEAD/vignettes/articles/reproduce-simResults.Rmd" class="external-link"><code>vignettes/articles/reproduce-simResults.Rmd</code></a></small>
      <div class="d-none name"><code>reproduce-simResults.Rmd</code></div>
    </div>

    
    
<p>NOTE: Still need to add/install Phylofit for comparison. Simulation
numbers need to be increased to match what we’ve done in our preprint.
This is a work in progress at the moment.</p>
<p>In this article, we’ll reproduce the simulations we include in <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v1/" class="external-link">our
recent preprint.</a> We’ll skip over many of the basics, as those are
detailed in our introductory simulation article/vignette which is
available in <code><a href="../articles/cloneRate-simulate.html">vignette("cloneRate-simulate")</a></code>. The simulation
procedure for generating birth-death trees is a direct implementation of
results by Amaury Lambert in <a href="https://pubmed.ncbi.nlm.nih.gov/29704514/" class="external-link">a recent paper</a>.
These results allowed us to simulate thousands of trees to check our
methods for growth rate estimation from phylogenetic tree
reconstruction, which is detailed in <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v1/" class="external-link">our
recent preprint.</a> We’ll reproduce this validation here.</p>
<div class="section level3">
<h3 class="unnumbered" id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>First, we’ll have to load the packages we want to use. We’ll be
plotting the trees using the <a href="https://rdrr.io/cran/ape/" class="external-link"><code>ape</code></a> package function
<a href="https://rdrr.io/cran/ape/man/plot.phylo.html" class="external-link"><code>ape::plot.phylo()</code></a>
along with some other <code>ape</code> functions. If you have
<code>cloneRate</code> installed, you already have the <a href="https://rdrr.io/cran/ape/" class="external-link"><code>ape package</code></a>. We’ll
also be using <a href="https://ggplot2.tidyverse.org/" class="external-link"><code>ggplot2</code></a> to make
our plots, which can be installed from CRAN as shown below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load and attach our package cloneRate</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bdj34/cloneRate" class="external-link">cloneRate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and attach ape, which will be installed if you've installed cloneRate</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install ggplot2 if necessary, then load and attach it with library()</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>For applying Phylofit, which was developed by Nicholas Williams and
applied in <a href="https://www.nature.com/articles/s41586-021-04312-6" class="external-link">Williams et
al.</a> and <a href="https://www.nature.com/articles/s41586-022-04786-y" class="external-link">Mitchell et
al.</a>, see Emily Mitchell’s github: <a href="https://github.com/emily-mitchell/normal_haematopoiesis/blob/main/1_functions/farm_only/phylofit.R" class="external-link">https://github.com/emily-mitchell/normal_haematopoiesis/blob/main/1_functions/farm_only/phylofit.R</a></p>
<p>We’ll also set the color palette which we’ll use for most of the
plotting. The palette is taken from <a href="https://davidmathlogic.com/colorblind/#%23000000-%23E69F00-%2356B4E9-%23009E73-%23F0E442-%230072B2-%23D55E00-%23CC79A7" class="external-link">here</a></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colorPal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="varying-parameters">Varying parameters<a class="anchor" aria-label="anchor" href="#varying-parameters"></a>
</h2>
<p>So far, we’ve looked at the same parameters. Now, we’ll see what
happens when we change some important parameters about the birth-death
process.</p>
<div class="section level3">
<h3 id="varying-n">Varying n<a class="anchor" aria-label="anchor" href="#varying-n"></a>
</h3>
<p>One of the most interesting results to explore further is how the
accuracy of the estimates depends on the number of samples. For this,
we’ll look at a few different <code>n</code> parameter values. To keep
things from running for too long, we can re-use our trees from
<code>n=100</code> and add 150 more trees at different <code>n</code>
values. For this, let’s show how to run <code><a href="../reference/simUltra.html">simUltra()</a></code> with a
vector input for <code>n</code>. First, we’ll generate the vector, which
we’ll call <code>n_vec</code>. Let’s explore a small <code>n</code>
value, 10, and an intermediate <code>n</code> value, 30.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">150</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For now, we’ll keep the growth rate <code>a - b</code> equal to 1,
but again we’ll let the actual birth and death rates vary.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_vec</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">300</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">b_vec</span> <span class="op">&lt;-</span> <span class="va">a_vec</span> <span class="op">-</span> <span class="fl">1</span></span></code></pre></div>
<p>In total, our <code>n_vec</code> is of length 300. So we’ll want to
make sure <code>a_vec</code> and <code>b_vec</code> are also of length
300. And we’ll have to set <code>nTrees = 300</code>. If we generate
multiple trees, we either set a single value for the parameters, or a
vector of length <code>nTrees</code>. This applies to both
<code><a href="../reference/simUltra.html">simUltra()</a></code> and <code><a href="../reference/simMut.html">simMut()</a></code>. Let’s generate some
more trees. Note: this will also take a few minutes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n10_n30_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="va">a_vec</span>, b <span class="op">=</span> <span class="va">b_vec</span>, cloneAge <span class="op">=</span> <span class="fl">20</span>, n <span class="op">=</span> <span class="va">n_vec</span>,</span>
<span>  nTrees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n_vec</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s apply our estimates and combine the data.frames:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply our estimates for ultrametric trees</span></span>
<span><span class="va">n10_n30_maxLike</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.html">maxLikelihood</a></span><span class="op">(</span><span class="va">n10_n30_trees</span><span class="op">)</span></span>
<span><span class="va">n10_n30_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/internalLengths.html">internalLengths</a></span><span class="op">(</span><span class="va">n10_n30_trees</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the estimates</span></span>
<span><span class="va">n10_n30_both</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">n10_n30_maxLike</span>, <span class="va">n10_n30_lengths</span><span class="op">)</span></span></code></pre></div>
<p>Add text here</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="va">results_vary_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">n10_n30_both</span><span class="op">)</span></span></code></pre></div>
<p>Let’s make a plot for each of these, showing the performance. We’ll
use <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> in order to show the same plot at
various <code>n</code> values. Although we have a different number of
trees from the <code>n = 100</code> case, the density plot will
normalize this.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results_vary_n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">exampleUltraTrees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">r</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Net growth rate estimate (r)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Internal lengths"</span>, <span class="st">"Max. likelihood"</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"#009E73"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"n = "</span>, <span class="va">n</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n = 10"</span>, <span class="st">"n = 30"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">1</span>, strip.position <span class="op">=</span> <span class="st">"bottom"</span>, scales <span class="op">=</span> <span class="st">"free"</span>, dir <span class="op">=</span> <span class="st">"v"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing non-finite values (`stat_density()`).</span></span></code></pre></div>
<p><img src="reproduce-simResults_files/figure-html/plot_vary_n-1.png" width="100%"></p>
<p>As you can see, both estimates are highly dependent on the number of
samples. If you’d like to see the same density values on the y-axis for
all three <code>n</code> values, set <code>scales = "fixed"</code> in
the <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code> function.</p>
<p>If you’re interested, you can apply the same quantitative measures to
this data as we did before in [Quantitative comparisons]. We won’t
repeat that here, but we show this in Figure 2 of <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v1/" class="external-link">our
preprint</a>. This information is also available in the Supplementary
tables, which are also available as .csv files.</p>
</div>
<div class="section level3">
<h3 id="varying-r-andor-cloneage">Varying r (and/or cloneAge)<a class="anchor" aria-label="anchor" href="#varying-r-andor-cloneage"></a>
</h3>
<p>As we noted before, we can simulate many trees at once using
<code><a href="../reference/simUltra.html">simUltra()</a></code> and <code><a href="../reference/simMut.html">simMut()</a></code>. Here, we’ll use
<code><a href="../reference/simUltra.html">simUltra()</a></code> to generate 100 trees at various growth rates.
We do a similar analysis in Figures 3 and 4 of <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v1/" class="external-link">our
preprint</a>, noting that our methods struggle with small growth rates.
Let’s see if we come to the same conclusion here.</p>
<div class="section level4">
<h4 id="varying-r-or-cloneage">Varying r or cloneAge?<a class="anchor" aria-label="anchor" href="#varying-r-or-cloneage"></a>
</h4>
<p>First, we have to address something that might otherwise lead to
confusion; varying <code>r</code> is the same as varying
<code>cloneAge</code>. When you think about it, it makes sense. If I
simulate a population with a net growth rate of 1 per year for 20 years
it should look the same as a growth rate of 0.5 per year for 40 years.
We’ll show this, but first consider the fact that the units are
meaningless, so long as they’re consistent. So a growth rate of 1/12 and
a clone age of 20*12 is exactly the same as a growth rate of 1 and 20 if
the units change from a years to months.</p>
<p>This all might be a bit confusing, so let’s plot it. First, we’ll
simulate a tree with a growth rate of 2 for 30 years and compare it to a
tree with a growth rate of 0.5 and the same 30 years. These trees should
look different. Finally, we’ll add a tree that has a growth rate of 0.5,
but run it for 120 years. If what I said above is true, we should see
that the last tree looks like the first tree, because 0.5 for 120 should
be the same as 2 for 30. Let’s find out:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First tree, r = a - b = 2</span></span>
<span><span class="va">tree1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">2.5</span>, b <span class="op">=</span> <span class="fl">.5</span>, cloneAge <span class="op">=</span> <span class="fl">30</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Second tree, with r = a - b = 0.5</span></span>
<span><span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">.5</span>, cloneAge <span class="op">=</span> <span class="fl">30</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Third tree, with r = 0.5 but cloneAge = 120</span></span>
<span><span class="va">tree3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">.5</span>, cloneAge <span class="op">=</span> <span class="fl">120</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s plot using <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code> to show all three in one
plot</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree1</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"r = 2, cloneAge = 30"</span><span class="op">)</span></span>
<span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree2</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"r = 0.5, cloneAge = 30"</span><span class="op">)</span></span>
<span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree3</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"r = 0.5, cloneAge = 120"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reproduce-simResults_files/figure-html/plot_vary_r-1.png" width="100%"></p>
<p>While the trees on the left and the right aren’t identical due to the
stochastic nature of the birth-death process, they are similar, and
certainly different from the tree in the middle.</p>
</div>
<div class="section level4">
<h4 id="performance-across-r-values">Performance across r values<a class="anchor" aria-label="anchor" href="#performance-across-r-values"></a>
</h4>
<p>Now we can arbitrarily choose whether to vary <code>r</code> or
<code>cloneAge</code>. For consistency, we’ll vary <code>r</code>, as we
do in Figures 3 and 4 of <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v1/" class="external-link">our
preprint</a>. Here, we have two options:</p>
<ol style="list-style-type: decimal">
<li>Simulate at fixed <code>r</code> values, showing which are good and
which are problematic</li>
<li>Simulate at random <code>r</code> values and then try to decipher
which estimates are good and which aren’t</li>
</ol>
<p>Option 1 is essentially the same as we did in <a href="#varying-n">Varying n</a>, but with <code>r</code> instead of
<code>n</code>, so repeating that here wouldn’t be as useful. Option 2
is also more realistic…we can pretend we don’t know the ground truth and
show how we decide if our methods are relevant before comparing to the
ground truth.</p>
<p>Let’s simulate 200 trees with 50 samples and various growth rates,
ranging from 0.1 to 1 per year, run for 40 years.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Uniform ditribution of r used to generate b_vec</span></span>
<span><span class="va">r_vec</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span>, min <span class="op">=</span> <span class="fl">0.1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">a_vec</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">b_vec</span> <span class="op">&lt;-</span> <span class="va">a_vec</span> <span class="op">-</span> <span class="va">r_vec</span></span>
<span></span>
<span><span class="co"># Input to simUltra()</span></span>
<span><span class="va">vary_r_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a_vec</span>, b <span class="op">=</span> <span class="va">b_vec</span>, cloneAge <span class="op">=</span> <span class="fl">40</span>, n <span class="op">=</span> <span class="fl">50</span>, nTrees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a_vec</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Apply our <code><a href="../reference/maxLikelihood.html">maxLikelihood()</a></code> function as usual…</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maxLike_vary_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.html">maxLikelihood</a></span><span class="op">(</span><span class="va">vary_r_trees</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span></code></pre></div>
<p>Uh oh… that’s a long list of warnings. Let’s read through and see
what’s going on. The ratio of external to internal lengths is a measure
of how “supercritical” or star-shaped the birth-death process is. If the
internal lengths are at the top of the tree, we consider it star-shaped,
and it’s a good candidate for our methods, which operate under the
assumption of a supercritical process. This means that the growth rate
is high enough, and enough time has passed, for the coalescence events
to occur well before the sampling time. In practice, using these
simulations, we show that an external to internal lengths ratio greater
than 3 is good enough to apply our methods. Let’s apply our methods and
see how they look before and after applying this ratio cutoff. Note that
this is what we’re doing in Figure 4 of <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v1/" class="external-link">our
preprint</a>.</p>
<p>Let’s apply the internal lengths method, this time suppressing the
warning.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lengths_vary_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="../reference/internalLengths.html">internalLengths</a></span><span class="op">(</span><span class="va">vary_r_trees</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Because we have different <code>r</code> values, we can’t do a
density plot as before. We’ll have to show a density plot with the x
axis representing percent error. In this case, good estimates will
consolidate around 0. First, we’ll calculate error using the
<code>estimate</code> column and <code>r_vec</code> which has our ground
truth values.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate error in lengths, adding columns</span></span>
<span><span class="va">lengths_vary_r</span><span class="op">$</span><span class="va">ground_truth</span> <span class="op">&lt;-</span> <span class="va">r_vec</span></span>
<span><span class="va">lengths_vary_r</span><span class="op">$</span><span class="va">percent_error</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">lengths_vary_r</span><span class="op">$</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">lengths_vary_r</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span> <span class="op">/</span> <span class="va">lengths_vary_r</span><span class="op">$</span><span class="va">ground_truth</span></span>
<span></span>
<span><span class="co"># Do the same for maxLike</span></span>
<span><span class="va">maxLike_vary_r</span><span class="op">$</span><span class="va">ground_truth</span> <span class="op">&lt;-</span> <span class="va">r_vec</span></span>
<span><span class="va">maxLike_vary_r</span><span class="op">$</span><span class="va">percent_error</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">maxLike_vary_r</span><span class="op">$</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">maxLike_vary_r</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span> <span class="op">/</span> <span class="va">maxLike_vary_r</span><span class="op">$</span><span class="va">ground_truth</span></span>
<span></span>
<span><span class="co"># Combine for ggplot formatting</span></span>
<span><span class="va">results_vary_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">lengths_vary_r</span>, <span class="va">maxLike_vary_r</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot, adding a vertical line at 0 because that's the error free estimate</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results_vary_r</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">percent_error</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">300</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Estimate percent error"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Internal lengths"</span>, <span class="st">"Max. likelihood"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"#009E73"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing non-finite values (`stat_density()`).</span></span></code></pre></div>
<p><img src="reproduce-simResults_files/figure-html/coverage_vary_r-1.png" width="100%"></p>
<p>Not bad, but we have some rogue estimates with &gt; 200% error! And
we have many with &gt; 50% error. Let’s apply that cutoff ratio of 3 to
exclude the trees which we don’t think are good candidates for our
methods. Hopefully, this will get rid of the very poor estimates.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Cut those trees with ratio &gt; 3</span></span>
<span><span class="va">results_vary_r_cut</span> <span class="op">&lt;-</span> <span class="va">results_vary_r</span><span class="op">[</span><span class="va">results_vary_r</span><span class="op">$</span><span class="va">extIntRatio</span> <span class="op">&gt;=</span> <span class="fl">3</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># How many did we cut</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results_vary_r</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">results_vary_r_cut</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 21</span></span>
<span></span>
<span><span class="co"># Plot, adding a vertical line at 0 because that's the error free estimate</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results_vary_r_cut</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">percent_error</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">300</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Estimate percent error"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Internal lengths"</span>, <span class="st">"Max. likelihood"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"#009E73"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reproduce-simResults_files/figure-html/applyCutoff-1.png" width="100%"></p>
<p>I’d say that’s much better. We cut 24 of the 200 trees, eliminating
many of the worst estimates. The real advantage here is that we can look
at a tree calculate this ratio which will tell us right away if our
methods are applicable. Again, if you’re interested in the quantitative
side of this, you can apply the metrics from the [Quantitative
comparisons] section.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>The method for simulating the trees is a direct result of the work of
Amaury Lambert in the following paper. The mathematical methods for
estimating growth rates build in large part from the same work, linked
below:</p>
<ul>
<li><a href="https://pubmed.ncbi.nlm.nih.gov/29704514/" class="external-link">Lambert,
2018</a></li>
</ul>
<p>And here’s a final link to <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v1/" class="external-link">our
paper</a> for more of the details of the methods and data analysis.</p>
<p>There aren’t too many colors in this vignette, but we tried to use
colorblind friendly colors, specifically pulling colors from a palette
designed by <a href="https://www.nature.com/articles/nmeth.1618" class="external-link">Bang
Wong</a> and available <a href="https://davidmathlogic.com/colorblind/#%23000000-%23E69F00-%2356B4E9-%23009E73-%23F0E442-%230072B2-%23D55E00-%23CC79A7" class="external-link">here.</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brian Johnson, Yubo Shuai, Jason Schweinsberg, Kit Curtius.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
