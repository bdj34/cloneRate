<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cloneRate">
<title>Validating growth rate estimates via simulation • cloneRate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validating growth rate estimates via simulation">
<meta property="og:description" content="cloneRate">
<meta property="og:image" content="https://bdj34.github.io/cloneRate/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cloneRate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/reproduce-simResults.html">Reproduce simulation results</a>
    <a class="dropdown-item" href="../articles/cloneRate-dataAnalysis.html">Analysis of human blood data</a>
    <a class="dropdown-item" href="../articles/cloneRate-simulate.html">Validating growth rate estimates via simulation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bdj34/cloneRate/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Validating growth rate estimates via simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bdj34/cloneRate/blob/HEAD/vignettes/cloneRate-simulate.Rmd" class="external-link"><code>vignettes/cloneRate-simulate.Rmd</code></a></small>
      <div class="d-none name"><code>cloneRate-simulate.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we’ll walk through how we simulated a birth-death
branching process to validate our growth rate methods. The simulation
procedure is a direct implementation of results by Amaury Lambert in <a href="https://pubmed.ncbi.nlm.nih.gov/29704514/" class="external-link">a recent paper</a>.
We’ll show here that these results allow for extremely fast generation
of a sampled tree of size <span class="math inline">\(n\)</span> from a
birth-death process of time <span class="math inline">\(T\)</span> with
fixed birth and death rates. The key point here is that we don’t have to
simulate this using computationally intensive algorithms (gillespie
etc.); the math provides a shortcut which allows us to generate the
results on a single core in under a second for a tree with 100 tips or
about 8 seconds for a tree with 1000 tips! In R!</p>
<p>The applications of this fast generation of sampled trees are
countless. For us, these results allowed us to simulate thousands of
trees to check our methods for growth rate estimation from phylogenetic
tree reconstruction, which is detailed in <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v2/" class="external-link">our
recent preprint.</a> We’ll reproduce this validation here.</p>
<div class="section level3">
<h3 class="unnumbered" id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>First, we’ll have to load the packages we want to use. We’ll be
plotting the trees using the <a href="https://rdrr.io/cran/ape/" class="external-link"><code>ape</code></a> package function
<a href="https://rdrr.io/cran/ape/man/plot.phylo.html" class="external-link"><code>ape::plot.phylo()</code></a>
along with some other <code>ape</code> functions. If you have
<code>cloneRate</code> installed, you already have the <a href="https://rdrr.io/cran/ape/" class="external-link"><code>ape package</code></a>. We’ll
also be using <a href="https://ggplot2.tidyverse.org/" class="external-link"><code>ggplot2</code></a> to make
our plots, which can be installed from CRAN as shown below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load and attach our package cloneRate</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bdj34/cloneRate" class="external-link">cloneRate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and attach ape, which will be installed if you've installed cloneRate</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install ggplot2 if necessary, then load and attach it with library()</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>We’ll also set the color palette which we’ll use for most of the
plotting. The palette is taken from <a href="https://davidmathlogic.com/colorblind/#%23000000-%23E69F00-%2356B4E9-%23009E73-%23F0E442-%230072B2-%23D55E00-%23CC79A7" class="external-link">here</a></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colorPal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-trees">Simulating trees<a class="anchor" aria-label="anchor" href="#simulating-trees"></a>
</h2>
<p>In this section, we’ll simulate ultrametric and mutation-based trees.
Ultrametric just means that the tips are all the same distance from the
root. In our specific case, the ultrametric trees will have edge lengths
in units of time, so ultrametric means that the tips are sampled at the
same time. Mutation-based trees are those with edge lengths in units of
mutations. Mutation-based trees will typically not be ultrametric,
because there will be some fluctuations in the number of mutations
acquired.</p>
<p>We’ll be generating trees of class <code>phylo</code>, which is a
fairly straightforward encoding of phylogenetic trees in R. The ape
documentation describing the class <code>phylo</code> can be found <a href="http://ape-package.ird.fr/misc/FormatTreeR_24Oct2012.pdf" class="external-link">here.</a></p>
<div class="section level3">
<h3 id="ultrametric-trees">Ultrametric trees<a class="anchor" aria-label="anchor" href="#ultrametric-trees"></a>
</h3>
<p>Let’s start with ultrametric trees. First, let’s simulate a single
tree and have a look at the class <code>phylo</code>. We’ll use the
function <code><a href="../reference/simUltra.html">simUltra()</a></code> from our package to do this, which
simulates an ultrametric tree. We’ll set a birth rate <code>a</code>, a
death rate <code>b</code>, an age for the tree <code>cloneAge</code>,
and the number of sampled tips <code>n</code>. Note that we use
<code>cloneAge</code> instead of <span class="math inline">\(T\)</span>
for the time because <code>T</code> in R means <code>TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate the tree</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">0</span>, cloneAge <span class="op">=</span> <span class="fl">20</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We see that the tree is of class phylo</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "phylo"</span></span>
<span></span>
<span><span class="co"># Preview the tree</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phylogenetic tree with 100 tips and 99 internal nodes.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tip labels:</span></span>
<span><span class="co">#&gt;   t14, t62, t21, t38, t89, t88, ...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rooted; includes branch lengths.</span></span></code></pre></div>
<p>Again, the best place to get more info about the class
<code>phylo</code> is <a href="http://ape-package.ird.fr/misc/FormatTreeR_24Oct2012.pdf" class="external-link">here.</a>
Our functions for simulating trees will include metadata. Let’s take a
look at the metadata included in the tree.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt;   r a b cloneAge   n runtime_seconds addStem</span></span>
<span><span class="co">#&gt; 1 1 1 0       20 100           0.912   FALSE</span></span></code></pre></div>
<p>We see that the columns are:</p>
<ul>
<li>
<code>r</code>, <code>a</code>, <code>b</code>: The growth rate
params. <code>r</code> is the net growth rate, <code>a</code> is birth
rate and <code>b</code> is death rate, so <code>r=a-b</code>
</li>
<li>
<code>cloneAge</code>: The time that passes, in the same units as
<code>r</code>, <code>a</code>, and <code>b</code>.</li>
<li>
<code>n</code>: The number of samples from the birth-death process,
producing a tree with <code>n</code> tips.</li>
<li>
<code>runtime_seconds</code>: The elapsed time to generate the
tree.</li>
<li>
<code>addStem</code>: Tells us whether the tree has a root edge
preceding the first split. We’ll show the “stem” in plots below.</li>
</ul>
<p>Now let’s plot the tree.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, backward <span class="op">=</span> <span class="cn">FALSE</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"Simulated tree"</span>, ylab <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cloneRate-simulate_files/figure-html/plotOne-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>In the tree we plotted above, we see that the “stem” is the edge
extending from time 0 to the first split. We call these splits
coalescence events and they’ll be very important for our methods of
growth rate estimation.</p>
<p>Also, we see that the tree is ultrametric, meaning that they all are
sampled at the same time, in this case 20 units of time after the
birth-death process began. As a default, we’ll talk about units of time
in years, but that is arbitrary. Just make sure the units of the growth
rate (per year) are the same as the time units (years).</p>
<p>Let’s apply our growth rate estimates to this tree, seeing if our
estimates are close to the value of <code>r</code> that we used to
generate the tree. We have two functions for estimating the growth rate
of an ultrametric tree, and we’ll compare their performance later
on:</p>
<ul>
<li>
<code><a href="../reference/internalLengths.html">internalLengths()</a></code>: This function sums the edge lengths
of the internal edges of the tree (excluding the stem). We call this sum
<span class="math inline">\(L_i\)</span>. The growth rate is calculated
as <span class="math inline">\(r = L_i / n\)</span> where <span class="math inline">\(n\)</span> is the number of sampled tips.</li>
<li>
<code><a href="../reference/maxLikelihood.html">maxLikelihood()</a></code>: This function uses a maximum
likelihood estimation of the distribution of coalescence times, using
the information about when the tree splits. The distribution of
coalescence times is approximated by a standard logistic distribution
scaled by <span class="math inline">\(1/r\)</span>. Maximizing the
likelihood of the observed coalescence times for the <span class="math inline">\(r\)</span> term gives us our estimate.</li>
</ul>
<p>Both methods are detailed in <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v2/" class="external-link">our
recent preprint.</a></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/maxLikelihood.html">maxLikelihood</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">$</span><span class="va">estimate</span></span>
<span><span class="co">#&gt; [1] 1.123968</span></span>
<span></span>
<span><span class="fu"><a href="../reference/internalLengths.html">internalLengths</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">$</span><span class="va">estimate</span></span>
<span><span class="co">#&gt; [1] 1.043864</span></span></code></pre></div>
<p>We know that our actual growth rate is 1, so we can evaluate how our
estimates are doing. One estimate doesn’t really tell us much though.
Let’s try 100. To do this, we just set the <code>nTrees</code> param
equal to 100 in our <code><a href="../reference/simUltra.html">simUltra()</a></code> function. You can
parallelize this process if you have the <code>parallel</code> package
installed by simply setting <code>nCores</code>, but we’ll leave this at
1 for now. By printing the elapsed time, we see that with only one core
it takes about a minute.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tree.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">0</span>, cloneAge <span class="op">=</span> <span class="fl">20</span>, n <span class="op">=</span> <span class="fl">100</span>, nTrees <span class="op">=</span> <span class="fl">100</span>, nCores <span class="op">=</span> <span class="fl">1</span>, addStem <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">ptm</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 84.295</span></span></code></pre></div>
<p>Let’s apply our methods to these trees. We can input either a single
<code>phylo</code> object, or a list of <code>phylo</code> objects to
our growth rate functions. Either way, it’ll return a
<code>data.frame</code> which each row corresponding to an estimate for
each tree.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsMaxLike</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.html">maxLikelihood</a></span><span class="op">(</span><span class="va">tree.list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resultsLengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/internalLengths.html">internalLengths</a></span><span class="op">(</span><span class="va">tree.list</span><span class="op">)</span></span></code></pre></div>
<p>We gave each method 100 trees to estimate, let’s plot these
estimates. Remember that all the input trees had a growth rate of 1, so
we want these estimates to be close to 1. We’ll use ggplot’s density
plot for this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine for ggplot formatting</span></span>
<span><span class="va">resultsCombined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">resultsLengths</span>, <span class="va">resultsMaxLike</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot, adding a vertical line at r=1 because that's the true growth rate</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">resultsCombined</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">exampleUltraTrees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">r</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Net growth rate estimate (r)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Internal lengths"</span>, <span class="st">"Max. likelihood"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"#009E73"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="cloneRate-simulate_files/figure-html/plotEstimates-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Not bad, but we’ll want to test this more formally over a large range
of parameter values. More on that later in this vignette. For now, let’s
shift our attention to mutation trees.</p>
</div>
<div class="section level3">
<h3 id="mutation-trees">Mutation trees<a class="anchor" aria-label="anchor" href="#mutation-trees"></a>
</h3>
<p>There are two ways to generate mutation trees:</p>
<ul>
<li>We can add mutations to a time-based ultrametric tree</li>
<li>We can generate a completely new mutation-based tree</li>
</ul>
<p>Either way, the process of generating mutation trees consists of:</p>
<ul>
<li>Generating an ultrametric, time-based tree. This step is only
required to generate a new tree</li>
<li>For each edge, draw the number of mutations from a poisson
distribution with mean equal to the mutation rate <code>nu</code>
multiplied by the edge length of the time-based tree.</li>
</ul>
<p>Let’s take the ultrametric trees we just generated and convert them
to mutation-based trees. For this, we provide the function
<code><a href="../reference/ultra2mut.html">ultra2mut()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set mutation rate equal to 10 muts/year for all trees</span></span>
<span><span class="va">mutTree.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ultra2mut.html">ultra2mut</a></span><span class="op">(</span><span class="va">tree.list</span>, nu <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we can generate a new set of mutation trees using the
function <code><a href="../reference/simMut.html">simMut()</a></code>. We won’t run this because it will take
another few minutes, and we already have the mutation-based trees
generated above.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set params for ultra tree + a mutation rate</span></span>
<span><span class="va">mutTree.list2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simMut.html">simMut</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">0</span>, cloneAge <span class="op">=</span> <span class="fl">20</span>, n <span class="op">=</span> <span class="fl">100</span>, nTrees <span class="op">=</span> <span class="fl">100</span>, nu <span class="op">=</span> <span class="fl">100</span>, nCores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>If we want to estimate the growth rate from a mutation tree, we use
the <code><a href="../reference/sharedMuts.html">sharedMuts()</a></code> function, which works very similarly to
the <code><a href="../reference/internalLengths.html">internalLengths()</a></code> function. However, instead of
counting the internal edge lengths in units of time, the
<code><a href="../reference/sharedMuts.html">sharedMuts()</a></code> function counts the internal/shared mutations
and uses the mutation rate to scale to time. So, if <span class="math inline">\(M_i\)</span> is the number of internal or shared
mutations, <span class="math inline">\(nu\)</span> is the mutation rate,
and <span class="math inline">\(n\)</span> is the number of samples, the
growth rate estimate is <span class="math inline">\(r = M_i /(\nu
n)\)</span>.</p>
<p>Let’s apply the <code><a href="../reference/sharedMuts.html">sharedMuts()</a></code> function to the trees that
we converted to mutation-based. Remember that these mutation-based trees
are generated from the ultrametric trees we applied our functions
<code><a href="../reference/maxLikelihood.html">maxLikelihood()</a></code> and <code><a href="../reference/internalLengths.html">internalLengths()</a></code> to.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsShared</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sharedMuts.html">sharedMuts</a></span><span class="op">(</span><span class="va">mutTree.list</span>, nu <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot the estimates all together. First, we’ll combine the
data.frames produced. The <code><a href="../reference/sharedMuts.html">sharedMuts()</a></code> function outputs an
additional column corresponding to the mutation rate <code>nu</code>.
Because of this, using rbind on the full data.frames will give an error.
We only want to look at the estimates for now, so we’ll just combine the
necessary columns from each data.frame.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine the columns with the estimates</span></span>
<span><span class="va">colsUse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lowerBound"</span>, <span class="st">"estimate"</span>, <span class="st">"upperBound"</span>, <span class="st">"method"</span><span class="op">)</span></span>
<span><span class="va">resultsAll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">resultsShared</span><span class="op">[</span>, <span class="va">colsUse</span><span class="op">]</span>, <span class="va">resultsCombined</span><span class="op">[</span>, <span class="va">colsUse</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot, adding a vertical line at r=1 because that's the true growth rate</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">resultsAll</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">exampleUltraTrees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">r</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Net growth rate estimate (r)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Internal lengths"</span>, <span class="st">"Max. likelihood"</span>, <span class="st">"Shared Muts."</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">colorPal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">colorPal</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">colorPal</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="cloneRate-simulate_files/figure-html/plotAll-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>It looks like we’re on the right track. From this, it’s hard to tell
which is best. Maximum likelihood seems a bit biased on the high side,
but the estimates seem to fall in a more narrow range. Let’s do a more
quantitative analysis now that we have the hang of it.</p>
</div>
</div>
<div class="section level2">
<h2 id="quantitative-comparisons">Quantitative comparisons<a class="anchor" aria-label="anchor" href="#quantitative-comparisons"></a>
</h2>
<p>In this section, we’ll use our ability to generate trees in order to
test our methods. We’ll focus mainly on the ultrametric trees, noting
that the mutation-based approach based on shared mutations is analogous
to the internal lengths method. We’ll see how well our methods perform,
where they perform well, and where they fail.</p>
<div class="section level3">
<h3 id="max-likelihood-vs--internal-lengths-vs--shared-mutations">Max likelihood vs. internal lengths vs. shared mutations<a class="anchor" aria-label="anchor" href="#max-likelihood-vs--internal-lengths-vs--shared-mutations"></a>
</h3>
<p>We want to know which estimate is the best. We’ll start by making a
quantiative comparison of the 100 estimates we already have from our
simulations in the previous section. 100 trees should be enough to get
an idea of which estimate is most accurate, but we can always simulate
more. We won’t do that here though because it’ll take a bit longer and,
well, we have to stop somewhere.</p>
<div class="section level4">
<h4 id="root-mean-square-error-rmse">Root Mean Square Error (RMSE)<a class="anchor" aria-label="anchor" href="#root-mean-square-error-rmse"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the RMSE</span></span>
<span><span class="va">groundTruth</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">resultsAll</span>, <span class="va">resultsAll</span><span class="op">$</span><span class="va">method</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">groundTruth</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span></span>
<span><span class="co">#&gt;    lengths    maxLike sharedMuts </span></span>
<span><span class="co">#&gt; 0.11154461 0.08603883 0.12031179</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mean">Mean<a class="anchor" aria-label="anchor" href="#mean"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the mean</span></span>
<span><span class="va">simMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">resultsAll</span>, <span class="va">resultsAll</span><span class="op">$</span><span class="va">method</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">simMean</span><span class="op">)</span></span>
<span><span class="co">#&gt;    lengths    maxLike sharedMuts </span></span>
<span><span class="co">#&gt;   1.019055   1.029092   1.017690</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="standard-deviation">Standard deviation<a class="anchor" aria-label="anchor" href="#standard-deviation"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the standard deviation of our estimates</span></span>
<span><span class="va">simSD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">resultsAll</span>, <span class="va">resultsAll</span><span class="op">$</span><span class="va">method</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">simSD</span><span class="op">)</span></span>
<span><span class="co">#&gt;    lengths    maxLike sharedMuts </span></span>
<span><span class="co">#&gt;  0.1104588  0.0813790  0.1196036</span></span></code></pre></div>
<p>What we saw in the density plot is quantified in the mean, sd, and
rmse. Maximum likelihood usually performs best by Root Mean Square Error
(RMSE) even though it’s mean is a bit higher (usually around 1.04). With
only 100 trees, there will be larger fluctuations, so maximum likelihood
might have a higher RMSE than the other methods. The shared mutations
method typically performs a bit worse than its ultrametric cousin,
<code><a href="../reference/internalLengths.html">internalLengths()</a></code>. The randomness of the poissonian
mutation accumulation likely leads to a wider spread of estimates in
<code><a href="../reference/sharedMuts.html">sharedMuts()</a></code>, which explains the difference between the two
methods.</p>
</div>
<div class="section level4">
<h4 id="coverage-probability">Coverage probability<a class="anchor" aria-label="anchor" href="#coverage-probability"></a>
</h4>
<p>Up to now, we’ve only looked at the estimate itself. We note that our
methods also provide confidence intervals. The default, with
<code>alpha = 0.05</code>, is to provide 95% confidence intervals. While
you can change that if you’d like, 95% seems to be pretty standard, so
we’ll use that. If our 95% confidence interval is accurate, we’d expect
our estimates to fall within this interval 95% of the time. Let’s
check:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the coverage probability of our estimates</span></span>
<span><span class="va">groundTruth</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">simCoverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">resultsAll</span>, <span class="va">resultsAll</span><span class="op">$</span><span class="va">method</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Set insideInterval to TRUE if inside interval and FALSE if outside</span></span>
<span>    <span class="va">insideInterval</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">lowerBound</span> <span class="op">&lt;</span> <span class="va">groundTruth</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">$</span><span class="va">upperBound</span> <span class="op">&gt;</span> <span class="va">groundTruth</span><span class="op">)</span></span>
<span>    <span class="co"># Count TRUE as 1 and FALSE as 0. See the fraction inside interval</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">insideInterval</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">insideInterval</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">simCoverage</span><span class="op">)</span></span>
<span><span class="co">#&gt;    lengths    maxLike sharedMuts </span></span>
<span><span class="co">#&gt;       0.94       0.96       0.96</span></span></code></pre></div>
<p>We’re right around 95%, which is great! But you might expect that
<code><a href="../reference/maxLikelihood.html">maxLikelihood()</a></code>, which typically has the lowest RMSE, might
have the best coverage probability. In fact, the confidence interval for
the <code><a href="../reference/maxLikelihood.html">maxLikelihood()</a></code> function is narrower. The opposite is
true for <code><a href="../reference/sharedMuts.html">sharedMuts()</a></code> which has the widest confidence
interval to account for the randomness of mutation accumulation. With
only 100 trees, the coverage probability will only be a rough
estimate.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="varying-parameters">Varying parameters<a class="anchor" aria-label="anchor" href="#varying-parameters"></a>
</h2>
<p>So far, we’ve looked at the same parameters. Now, we’ll see what
happens when we change some important parameters about the birth-death
process.</p>
<div class="section level3">
<h3 id="varying-n">Varying n<a class="anchor" aria-label="anchor" href="#varying-n"></a>
</h3>
<p>One of the most interesting results to explore further is how the
accuracy of the estimates depends on the number of samples. For this,
we’ll look at a few different <code>n</code> parameter values. To keep
things from running for too long, we can re-use our trees from
<code>n=100</code> and add 100 more trees at different <code>n</code>
values. For this, let’s show how to run <code><a href="../reference/simUltra.html">simUltra()</a></code> with a
vector input for <code>n</code>. First, we’ll generate the vector, which
we’ll call <code>n_vec</code>. Let’s explore a small <code>n</code>
value, 10, and an intermediate <code>n</code> value, 30.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For now, we’ll keep the growth rate <code>a - b</code> equal to 1,
but again we’ll let the actual birth and death rates vary.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_vec</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">b_vec</span> <span class="op">&lt;-</span> <span class="va">a_vec</span> <span class="op">-</span> <span class="fl">1</span></span></code></pre></div>
<p>In total, our <code>n_vec</code> is of length 200. So we’ll want to
make sure <code>a_vec</code> and <code>b_vec</code> are also of length
200. And we’ll have to set <code>nTrees = 200</code>. If we generate
multiple trees, we either set a single value for the parameters, or a
vector of length <code>nTrees</code>. This applies to both
<code><a href="../reference/simUltra.html">simUltra()</a></code> and <code><a href="../reference/simMut.html">simMut()</a></code>. Let’s generate some
more trees. Note: this will also take a few minutes.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n10_n30_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="va">a_vec</span>, b <span class="op">=</span> <span class="va">b_vec</span>, cloneAge <span class="op">=</span> <span class="fl">20</span>, n <span class="op">=</span> <span class="va">n_vec</span>,</span>
<span>  nTrees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">n_vec</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s apply our estimates and combine the data.frames:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply our estimates for ultrametric trees</span></span>
<span><span class="va">n10_n30_maxLike</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxLikelihood.html">maxLikelihood</a></span><span class="op">(</span><span class="va">n10_n30_trees</span><span class="op">)</span></span>
<span><span class="va">n10_n30_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/internalLengths.html">internalLengths</a></span><span class="op">(</span><span class="va">n10_n30_trees</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the estimates</span></span>
<span><span class="va">n10_n30_both</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">n10_n30_maxLike</span>, <span class="va">n10_n30_lengths</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can add our <code>resultsCombined</code> data.frame from
before, which has the results of applying <code><a href="../reference/maxLikelihood.html">maxLikelihood()</a></code>
and <code><a href="../reference/internalLengths.html">internalLengths()</a></code> to the set of 100 ultrametric trees
at <code>n = 100</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Merge the results data.frames</span></span>
<span><span class="va">results_vary_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">n10_n30_both</span>, <span class="va">resultsCombined</span><span class="op">)</span></span></code></pre></div>
<p>Let’s make a plot for each of these, showing the performance. We’ll
use <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> in order to show the same plot at
various <code>n</code> values. Although we have a different number of
trees from the <code>n = 100</code> case, the density plot will
normalize this.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results_vary_n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">exampleUltraTrees</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">r</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Net growth rate estimate (r)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Internal lengths"</span>, <span class="st">"Max. likelihood"</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"#009E73"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"n = "</span>, <span class="va">n</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n = 10"</span>, <span class="st">"n = 30"</span>, <span class="st">"n = 100"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">1</span>, strip.position <span class="op">=</span> <span class="st">"bottom"</span>, scales <span class="op">=</span> <span class="st">"free"</span>, dir <span class="op">=</span> <span class="st">"v"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="cloneRate-simulate_files/figure-html/plot_vary_n-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>As you can see, both estimates are highly dependent on the number of
samples. If you’d like to see the same density values on the y-axis for
all three <code>n</code> values, set <code>scales = "fixed"</code> in
the <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap()</a></code> function.</p>
<p>If you’re interested, you can apply the same quantitative measures to
this data as we did before in <a href="#quantitative-comparisons">Quantitative comparisons</a>. We won’t
repeat that here, but we show this in Figure 2 of <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v2/" class="external-link">our
preprint</a>. This information is also available in the Supplementary
tables, which are also available as .csv files.</p>
</div>
<div class="section level3">
<h3 id="varying-r-andor-cloneage">Varying r (and/or cloneAge)<a class="anchor" aria-label="anchor" href="#varying-r-andor-cloneage"></a>
</h3>
<p>As we noted before, we can simulate many trees at once using
<code><a href="../reference/simUltra.html">simUltra()</a></code> and <code><a href="../reference/simMut.html">simMut()</a></code>. Here, we’ll use
<code><a href="../reference/simUltra.html">simUltra()</a></code> to generate 100 trees at various growth rates.
We do a similar analysis in Figures 3 and 4 of <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v2/" class="external-link">our
preprint</a>, noting that our methods struggle with small growth rates.
Let’s see if we come to the same conclusion here.</p>
<div class="section level4">
<h4 id="varying-r-or-cloneage">Varying r or cloneAge?<a class="anchor" aria-label="anchor" href="#varying-r-or-cloneage"></a>
</h4>
<p>First, we have to address something that might otherwise lead to
confusion; varying <code>r</code> is the same as varying
<code>cloneAge</code>. When you think about it, it makes sense. If I
simulate a population with a net growth rate of 1 per year for 20 years
it should look the same as a growth rate of 0.5 per year for 40 years.
We’ll show this, but first consider the fact that the units are
meaningless, so long as they’re consistent. So a growth rate of 1/12 and
a clone age of 20*12 is exactly the same as a growth rate of 1 and 20 if
the units change from a years to months.</p>
<p>This all might be a bit confusing, so let’s plot it. First, we’ll
simulate a tree with a growth rate of 2 for 30 years and compare it to a
tree with a growth rate of 0.5 and the same 30 years. These trees should
look different. Finally, we’ll add a tree that has a growth rate of 0.5,
but run it for 120 years. If what I said above is true, we should see
that the last tree looks like the first tree, because 0.5 for 120 should
be the same as 2 for 30. Let’s find out:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First tree, r = a - b = 2</span></span>
<span><span class="va">tree1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">2.5</span>, b <span class="op">=</span> <span class="fl">.5</span>, cloneAge <span class="op">=</span> <span class="fl">30</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Second tree, with r = a - b = 0.5</span></span>
<span><span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">.5</span>, cloneAge <span class="op">=</span> <span class="fl">30</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Third tree, with r = 0.5 but cloneAge = 120</span></span>
<span><span class="va">tree3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">.5</span>, cloneAge <span class="op">=</span> <span class="fl">120</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s plot using <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code> to show all three in one
plot</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree1</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"r = 2, cloneAge = 30"</span><span class="op">)</span></span>
<span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree2</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"r = 0.5, cloneAge = 30"</span><span class="op">)</span></span>
<span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">tree3</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"r = 0.5, cloneAge = 120"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cloneRate-simulate_files/figure-html/plot_vary_r-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>While the trees on the left and the right aren’t identical due to the
stochastic nature of the birth-death process, they are similar, and
certainly different from the tree in the middle.</p>
</div>
<div class="section level4">
<h4 id="performance-across-r-values">Performance across r values<a class="anchor" aria-label="anchor" href="#performance-across-r-values"></a>
</h4>
<p>Now we can arbitrarily choose whether to vary <code>r</code> or
<code>cloneAge</code>. For consistency, we’ll vary <code>r</code>, as we
do in Figures 3 and 4 of <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v2/" class="external-link">our
preprint</a>. Here, we have two options:</p>
<ol style="list-style-type: decimal">
<li>Simulate at fixed <code>r</code> values, showing which are good and
which are problematic</li>
<li>Simulate at random <code>r</code> values and then try to decipher
which estimates are good and which aren’t</li>
</ol>
<p>Option 1 is essentially the same as we did in <a href="#varying-n">Varying n</a>, but with <code>r</code> instead of
<code>n</code>, so repeating that here wouldn’t be as useful. Option 2
is also more realistic…we can pretend we don’t know the ground truth and
show how we decide if our methods are relevant before comparing to the
ground truth.</p>
<p>Let’s simulate 1000 trees with 50 samples <code>n</code> and various
growth rates <code>r</code>, ranging from 0.1 to 1 per year, run for 40
years. This will take a while, so we won’t actually evaluate this as
part of this vignette. However, we do a full reproduction of our work
from <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v2/" class="external-link">our
recent preprint</a> in <a href="https://bdj34.github.io/cloneRate/articles/reproduce-simResults.html">an
article, “Reproduce simulation results”</a> which can be found on <a href="https://bdj34.github.io/cloneRate/">our package website</a>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Uniform ditribution of r used to generate b_vec</span></span>
<span><span class="va">r_vec</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, min <span class="op">=</span> <span class="fl">0.1</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">a_vec</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">b_vec</span> <span class="op">&lt;-</span> <span class="va">a_vec</span> <span class="op">-</span> <span class="va">r_vec</span></span>
<span></span>
<span><span class="co"># Input to simUltra()</span></span>
<span><span class="va">vary_r_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">a_vec</span>, b <span class="op">=</span> <span class="va">b_vec</span>, cloneAge <span class="op">=</span> <span class="fl">40</span>, n <span class="op">=</span> <span class="fl">50</span>, nTrees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a_vec</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If we were to run the code above, we could analyze it the same as we
have done, with our <code><a href="../reference/internalLengths.html">internalLengths()</a></code> and
<code><a href="../reference/maxLikelihood.html">maxLikelihood()</a></code> functions. However, we’d also have to apply
our diagnostic, which tells us which clones are good candidates for our
method, and which are not. If we run a clone that’s not a good
candidate, we’ll get a warning. Let’s generate a tree with a very low
growth rate and plot it.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's call it slowClone</span></span>
<span><span class="va">slowClone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simUltra.html">simUltra</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">.15</span>, b <span class="op">=</span> <span class="fl">.05</span>, n <span class="op">=</span> <span class="fl">50</span>, cloneAge <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the tree</span></span>
<span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html" class="external-link">plot.phylo</a></span><span class="op">(</span><span class="va">slowClone</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>, show.tip.label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="cloneRate-simulate_files/figure-html/slowClone-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>We see that this tree has long internal branches and short external
branches. This indicates that the process has not been “supercritical”
enough (i.e. the growth rate and time are too low). Quantitatively, this
means the ratio of external to internal edge lengths is low. Let’s try
to apply our methods:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply our estimates</span></span>
<span><span class="fu"><a href="../reference/maxLikelihood.html">maxLikelihood</a></span><span class="op">(</span><span class="va">slowClone</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in maxLikelihood(slowClone): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means max. likelihood method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span><span class="co">#&gt;   lowerBound  estimate upperBound cloneAgeEstimate sumInternalLengths</span></span>
<span><span class="co">#&gt; 1  0.1386292 0.1804583  0.2222874         43.49246           302.0618</span></span>
<span><span class="co">#&gt;   sumExternalLengths extIntRatio  n alpha runtime_s  method</span></span>
<span><span class="co">#&gt; 1           286.5561   0.9486671 50  0.05     0.007 maxLike</span></span>
<span><span class="fu"><a href="../reference/internalLengths.html">internalLengths</a></span><span class="op">(</span><span class="va">slowClone</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in internalLengths(slowClone): External to internal lengths ratio is less than or equal to 3,</span></span>
<span><span class="co">#&gt;             which means internal lengths method may not be applicable. Consider</span></span>
<span><span class="co">#&gt;             using birthDeathMCMC() function, which avoids this issue.</span></span>
<span><span class="co">#&gt;   lowerBound estimate upperBound cloneAgeEstimate sumInternalLengths</span></span>
<span><span class="co">#&gt; 1  0.1196476 0.165529  0.2114105         43.99225           302.0618</span></span>
<span><span class="co">#&gt;   sumExternalLengths extIntRatio  n alpha runtime_s  method</span></span>
<span><span class="co">#&gt; 1           286.5561   0.9486671 50  0.05     0.003 lengths</span></span></code></pre></div>
<p>Our estimates are off by quite a bit (the ground truth estimate is
0.1), and we see a warning. The warning tells us that the external to
internal edge length ratio is below 3, so this clone is likely not a
good candidate for our methods. For details on how we came up with 3 as
a cutoff see Figure 4 of our preprint or the reproduced analysis in <a href="https://bdj34.github.io/cloneRate/articles/reproduce-simResults.html">the
article, “Reproduce simulation results”</a> from <a href="https://bdj34.github.io/cloneRate/">our package website</a>. The
real advantage to this diagnostic is that we can look at a tree and
calculate this ratio to tell us right away if our methods are
applicable. Again, if you’re interested in the quantitative side of
this, you can apply the metrics from the <a href="#quantitative-comparisons">Quantitative comparisons</a> section,
which we do in the longer form analysis in <a href="https://bdj34.github.io/cloneRate/articles/reproduce-simResults.html">the
article</a> mentioned above.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>The method for simulating the trees is a direct result of the work of
Amaury Lambert in the following paper. The mathematical methods for
estimating growth rates build in large part from the same work, linked
below:</p>
<ul>
<li><a href="https://pubmed.ncbi.nlm.nih.gov/29704514/" class="external-link">Lambert,
2018</a></li>
</ul>
<p>And here’s a final link to <a href="https://www.biorxiv.org/content/10.1101/2023.02.24.529817v2/" class="external-link">our
preprint</a> for more of the details of the methods and data
analysis.</p>
<p>There aren’t too many colors in this vignette, but we tried to use
colorblind friendly colors, specifically pulling colors from a palette
designed by <a href="https://www.nature.com/articles/nmeth.1618" class="external-link">Bang
Wong</a> and available <a href="https://davidmathlogic.com/colorblind/#%23000000-%23E69F00-%2356B4E9-%23009E73-%23F0E442-%230072B2-%23D55E00-%23CC79A7" class="external-link">here.</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brian Johnson, Yubo Shuai, Jason Schweinsberg, Kit Curtius.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
